class Rape{constructor(recv,conf){this._='20210305';this.config=conf;this.format=null;this.rotate=null;this.zygote=recv;console.log('//github.com/netcrashed/rape.js?'+this._)};lebe(str,run){if(!run){return str};let tmp='';while(str.length>2){tmp+=str.slice(-2);str=str.slice(0,-2)};return tmp+str};chew(part){switch(typeof(part)){case'object':if(!part.byteLength){return false};part=[...new Uint8Array(part)].map(b=>b.toString(16).padStart(2,'0')).join('');break;case'string':if(!part){return false};let raw=atob(part);part='';for(let i=0;i<raw.length;i++){let val=raw.charCodeAt(i).toString(16);part+=(val.length===2?val:'0'+val)};break;default:return false;break};if(!part){return false}else if(part.slice(0,12)=='474946383961'||part.slice(0,12)=='474946383761'){this.format='gif'}else if(part.slice(0,6)=='ffd8ff'){this.format='jpg'}else if(part.slice(0,16)=='89504e470d0a1a0a'){this.format='png'}else if(part.slice(0,4)=='424d'){this.format='bmp'}else if(part.slice(0,8)=='00000100'||part.slice(0,8)=='00000200'){this.format='ico'}else if(part.slice(0,8)=='52494646'&&part.slice(16,24)=='57454250'){this.format='webp'}else{return false};if(this.format=='jpg'){let app1_pos=part.indexOf('ffe1');if(app1_pos>=0&&part.slice(app1_pos+8,app1_pos+16)=='45786966'){let little_endian=(part.slice(app1_pos+20,app1_pos+24)=='4949');let offset=part.slice(app1_pos+28,app1_pos+36);offset=parseInt(this.lebe(offset,little_endian),16)*2+app1_pos+20;let tags_sum=parseInt(this.lebe(part.slice(offset,offset+4),little_endian),16);for(let i=0;i<tags_sum;i++){if(['0112','1201'].indexOf(part.slice(offset+(i*24)+4,offset+(i*24)+8))>=0){this.rotate=parseInt(this.lebe(part.slice(offset+(i*24)+20,offset+(i*24)+24),little_endian),16)}}}};return true};init(){return new Promise((done,fail)=>{if(typeof(this.zygote)=='object'){let reader=new FileReader();reader.readAsArrayBuffer(this.zygote.slice(0,65760));reader.onload=()=>{this.chew(reader.result)?done():fail()};reader.onerror=()=>{fail()}}else if(typeof(this.zygote)=='string'&&this.zygote.slice(0,4)=='blob'){let loader=new XMLHttpRequest;loader.responseType='arraybuffer';loader.onload=()=>{this.chew(loader.response.slice(0,65760))?done():fail()};loader.onerror=()=>{fail()};loader.open('GET',this.zygote);loader.send(null)}else if(typeof(this.zygote)=='string'&&this.zygote.slice(0,4)=='data'){let head=this.zygote.indexOf(',');this.chew(this.zygote.slice(head+1,head+87681))?done():fail()}else{fail()}})};async info(){await this.init();return this}};
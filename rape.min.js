class Rape{constructor(img){this._='20210305';this.format=null;this.length=null;this.rotate=null;this.zygote=img;console.log('//github.com/netcrashed/rape.js?'+this._)};lebe(str,run){if(!run){return str};let tmp='';while(str.length>2){tmp+=str.slice(-2);str=str.slice(0,-2)};return tmp+str};chew(prt){switch(typeof(prt)){case'object':if(!prt.byteLength){return false};prt=[...new Uint8Array(prt)].map(b=>b.toString(16).padStart(2,'0')).join('');break;case'string':if(!prt){return false};let raw=atob(prt);prt='';for(let i=0;i<raw.length;i++){let val=raw.charCodeAt(i).toString(16);prt+=(val.length===2?val:'0'+val)};break;default:return false;break};if(!prt){return false}else if(prt.slice(0,12)=='474946383961'||prt.slice(0,12)=='474946383761'){this.format='gif'}else if(prt.slice(0,6)=='ffd8ff'){this.format='jpg'}else if(prt.slice(0,16)=='89504e470d0a1a0a'){this.format='png'}else if(prt.slice(0,4)=='424d'){this.format='bmp'}else if(prt.slice(0,8)=='00000100'||prt.slice(0,8)=='00000200'){this.format='ico'}else if(prt.slice(0,8)=='52494646'&&prt.slice(16,24)=='57454250'){this.format='webp'}else{return false};if(this.format=='jpg'){let apppos=prt.indexOf('ffe1');if(apppos>=0&&prt.slice(apppos+8,apppos+16)=='45786966'){let little=(prt.slice(apppos+20,apppos+24)=='4949');let offset=parseInt(this.lebe(prt.slice(apppos+28,apppos+36),little),16)*2+apppos+20;for(let i=0;i<parseInt(this.lebe(prt.slice(offset,offset+4),little),16);i++){if(['0112','1201'].indexOf(prt.slice(offset+(i*24)+4,offset+(i*24)+8))>=0){this.rotate=parseInt(this.lebe(prt.slice(offset+(i*24)+20,offset+(i*24)+24),little),16)}}}};return true};init(){return new Promise((done,fail)=>{if(typeof(this.zygote)=='object'){let reader=new FileReader();reader.readAsArrayBuffer(this.zygote.slice(0,65760));reader.onload=()=>{this.length=this.zygote.size;this.chew(reader.result)?done():fail()};reader.onerror=()=>{fail()}}else if(typeof(this.zygote)=='string'&&this.zygote.slice(0,4)=='blob'){let loader=new XMLHttpRequest;loader.responseType='arraybuffer';loader.onload=()=>{this.length=loader.response.byteLength;this.chew(loader.response.slice(0,65760))?done():fail()};loader.onerror=()=>{fail()};loader.open('GET',this.zygote);loader.send(null)}else if(typeof(this.zygote)=='string'&&this.zygote.slice(0,4)=='data'){let header=this.zygote.indexOf(',');if(header<0){fail()};let tailer=this.zygote.indexOf('=');this.length=Math.round((((tailer<0)?this.zygote.length:tailer)-header-1)*0.75);this.chew(this.zygote.slice(header+1,header+87681))?done():fail()}else{fail()}})};async info(){await this.init().catch(()=>{fail()});return this};async conv(cfg){await this.init().catch(()=>{fail()});return new Promise((done,fail)=>{let img=new Image();img.src=(typeof(this.zygote)=='object')?URL.createObjectURL(this.zygote):this.zygote;img.onload=()=>{if(typeof(this.zygote)=='object'){URL.revokeObjectURL(img.src)};let cvs=document.createElement('canvas');cvs.width=img.naturalWidth;cvs.height=img.naturalHeight;let ctx=cvs.getContext('2d');ctx.fillStyle='rgba(255,255,255,0)';ctx.drawImage(img,0,0);done(cvs.toDataURL('image/jpeg',0.8))};img.onerror=()=>{fail()}})}};